<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Touch Gesture Controller</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1a1a1a;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
        }

        .container {
            position: relative;
            width: 640px;
            height: 480px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        #webcam {
            position: absolute;
            transform: scaleX(-1);
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #output_canvas {
            position: absolute;
            transform: scaleX(-1);
            width: 100%;
            height: 100%;
        }

        .controls {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            background: #333;
            padding: 20px;
            border-radius: 12px;
            align-items: center;
        }

        button {
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s;
        }

        .btn-start { background-color: #2ecc71; color: white; }
        .btn-stop { background-color: #e74c3c; color: white; }
        button:disabled { background-color: #555; cursor: not-allowed; }

        .stats {
            margin-top: 15px;
            font-family: monospace;
            font-size: 1.2rem;
            color: #00ffcc;
        }

        .gesture-indicator {
            margin-top: 10px;
            font-size: 1.1rem;
            color: #ffcc00;
        }
    </style>
</head>
<body>

    <h1>Touch Gesture</h1>
    
    <div class="container">
        <video id="webcam" autoplay playsinline></video>
        <canvas id="output_canvas"></canvas>
    </div>

    <div class="stats">
        Session Time: <span id="timer">00:00:00</span>
    </div>

    <div class="gesture-indicator" id="gesture-text">
        System: Standby
    </div>

    <div class="controls">
        <button class="btn-start" id="startBtn">START SYSTEM</button>
        <button class="btn-stop" id="stopBtn" disabled>STOP SYSTEM</button>
    </div>

    <script>
        const videoElement = document.getElementById('webcam');
        const canvasElement = document.getElementById('output_canvas');
        const canvasCtx = canvasElement.getContext('2d');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const timerText = document.getElementById('timer');
        const gestureText = document.getElementById('gesture-text');

        let camera = null;
        let startTime = null;
        let timerInterval = null;

        // Initialize Mediapipe Hands
        const hands = new Hands({
            locateFile: (file) => {
                return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
            }
        });

        hands.setOptions({
            maxNumHands: 1,
            modelComplexity: 1,
            minDetectionConfidence: 0.7,
            minTrackingConfidence: 0.7
        });

        function onResults(results) {
            canvasCtx.save();
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
            
            if (results.multiHandLandmarks) {
                for (const landmarks of results.multiHandLandmarks) {
                    drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS, {color: '#00FF00', lineWidth: 5});
                    drawLandmarks(canvasCtx, landmarks, {color: '#FF0000', lineWidth: 2});
                    
                    // Simple Gesture Logic: Check distance between Index Tip (8) and Thumb Tip (4)
                    const thumb = landmarks[4];
                    const index = landmarks[8];
                    const distance = Math.sqrt(Math.pow(thumb.x - index.x, 2) + Math.pow(thumb.y - index.y, 2));

                    if (distance < 0.05) {
                        gestureText.innerText = "GESTURE: PINCH (Select/Click)";
                    } else {
                        gestureText.innerText = "GESTURE: TRACKING HAND";
                    }
                }
            } else {
                gestureText.innerText = "System: Looking for hand...";
            }
            canvasCtx.restore();
        }

        hands.onResults(onResults);

        // Timer Function
        function updateTimer() {
            const now = new Date();
            const diff = new Date(now - startTime);
            const h = String(diff.getUTCHours()).padStart(2, '0');
            const m = String(diff.getUTCMinutes()).padStart(2, '0');
            const s = String(diff.getUTCSeconds()).padStart(2, '0');
            timerText.innerText = `${h}:${m}:${s}`;
        }

        // Start System
        startBtn.addEventListener('click', async () => {
            startBtn.disabled = true;
            stopBtn.disabled = false;
            
            if (!camera) {
                camera = new Camera(videoElement, {
                    onFrame: async () => {
                        await hands.send({image: videoElement});
                    },
                    width: 640,
                    height: 480
                });
            }
            
            startTime = new Date();
            timerInterval = setInterval(updateTimer, 1000);
            camera.start();
            gestureText.innerText = "System: Initializing...";
        });

        // Stop System
        stopBtn.addEventListener('click', () => {
            startBtn.disabled = false;
            stopBtn.disabled = true;
            
            if (camera) {
                camera.stop();
            }
            
            clearInterval(timerInterval);
            gestureText.innerText = "System: Stopped";
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
        });
    </script>
</body>
</html>
